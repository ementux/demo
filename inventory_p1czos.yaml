# OpenShift inventory file
# Fortuna PROD P1CZOS OpenShift v3.11 cluster 

#--------------#
# OSEv3 groups #
#--------------#
[OSEv3:children]
masters
etcd
nodes

#---------------------------------------#
# Variables common for all OSEv3 groups #
#---------------------------------------#
[OSEv3:vars]

# Ansible SSH user
ansible_ssh_user=ansible_master
ansible_become=True

# Ansible ssh port
ansible_port=22

# Deployment type
openshift_deployment_type=openshift-enterprise

# OpenShift release
openshift_release=v3.11

# Use RH Satellite 6
oreg_url=czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_ose-${component}:${version}
openshift_examples_modify_imagestreams=true

# Internal registry GUI Cockpit deployer
openshift_cockpit_deployer_prefix=czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_

# Web console prefix 
openshift_web_console_prefix=czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_ose-

# Service catalog
openshift_service_catalog_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_ose-"

# Etcd image 
osm_etcd_image="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-rhel7_etcd"

# Template service broker
template_service_broker_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_ose-"

# Ansible service broker
ansible_service_broker_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_ose-"
ansible_service_broker_etcd_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_ose-"


# Disable pre-install checks
openshift_disable_check=memory_availability,disk_availability,docker_image_availability,package_version

# Enable NFS storage for core components
openshift_enable_unsupported_configurations=true

# RPM installation
containerized=false

# Use FirewallD
os_firewall_use_firewalld=true

# Enable Cockpit UI
osm_use_cockpit=true

# Default K8s settings
openshift_node_kubelet_args={'pods-per-core':['10'],'max-pods':['250'],'image-gc-high-threshold':['90'],'image-gc-low-threshold':['80']}

#Node Group Definitions
openshift_node_groups=[{'name': 'node-config-master', 'labels': ['node-role.kubernetes.io/infra=true', 'node-role.kubernetes.io/master=true', 'region=czdc1', 'infra=master']},{'name': 'node-config-master-crio', 'labels': ['node-role.kubernetes.io/infra=true', 'region=czdc1', 'infra=master']},{'name': 'node-config-infra', 'labels': ['node-role.kubernetes.io/infra=true', 'region=czdc1', 'infra=generic']},{'name': 'node-config-infra-crio', 'labels': ['node-role.kubernetes.io/infra=true', 'region=czdc1', 'infra=generic']},{'name': 'node-config-infra-elastic', 'labels': ['node-role.kubernetes.io/infra=true', 'region=czdc1', 'infra=elastic']},{'name': 'node-config-infra-prometheus', 'labels': ['node-role.kubernetes.io/infra=true', 'region=czdc1', 'infra=prometheus']},{'name': 'node-config-compute', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compute=generic', 'priority=true']},{'name': 'node-config-compute-crio', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compute=generic', 'priority=true']},{'name': 'node-config-compute-build', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compte=build']},{'name': 'node-config-compute-build-crio', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compute=build']},{'name': 'node-config-compute-rabbit', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compute=rabbitmq']},{'name': 'node-config-compute-mongo', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compute=mongodb']},{'name': 'node-config-compute-elastic', 'labels': ['node-role.kubernetes.io/compute=true', 'region=czdc1', 'compute=elastic']},{'name': 'node-config-master-infra', 'labels': ['node-role.kubernetes.io/infra=true', 'infra=true']},{'name': 'node-config-all-in-one', 'labels': ['node-role.kubernetes.io/infra=true', 'node-role.kubernetes.io/infra=true', 'node-role.kubernetes.io/compute=true']},{'name': 'node-config-all-in-one-crio', 'labels': ['node-role.kubernetes.io/master=true', 'node-role.kubernetes.io/infra=true', 'node-role.kubernetes.io/compute=true']}]

#----------------------#
# Master configuration #
#----------------------#

# High availability
openshift_master_cluster_method=native

# Identity provider
#openshift_master_identity_providers=[{'name': 'allow_all', 'login': 'true', 'challenge': 'true', 'kind': 'AllowAllPasswordIdentityProvider'}]

# LDAP auth and CA cert
# Use VIP as LDAP url
openshift_master_identity_providers=[{'name': 'Fortuna_AD', 'challenge': 'true', 'login': 'true', 'kind': 'LDAPPasswordIdentityProvider', 'attributes': {'id': ['sAMAccountName'], 'email': ['mail'], 'name': ['cn'], 'preferredUsername': ['sAMAccountName']}, 'bindDN': 'CN=t_openshift_ldap,OU=Service Accounts,OU=windows-users,OU=CZ,DC=ad,DC=ifortuna,DC=cz', 'bindPassword': 'f23.7eww94', 'ca': 'Fortuna_ROOT_CA_end092027.crt', 'insecure': 'false', 'url': 'ldaps://cz-ntauth-f-p.ad.ifortuna.cz:636/DC=ad,DC=ifortuna,DC=cz?sAMAccountName'}]
openshift_master_ldap_ca_file=/home/ansible_master/openshift/ssl/ad.ifortuna.cz/Fortuna_ROOT_CA_end092027.crt

# OCP audit
openshift_master_audit_config={"enabled":true,"auditFilePath":"/var/lib/origin/log/oscp-audit.log","maximumFileRetentionDays":10,"maximumFileSizeMegabytes":10,"maximumRetainedFiles":10}

# OCP time synchronization (NTP)
openshift_clock_enabled=true

# CA_BUNDLE cert 
openshift_additional_ca=/home/ansible_master/openshift/ssl/ca_bundle.crt

# Master certificate
openshift_master_named_certificates=[{"certfile":"/home/ansible_master/openshift/ssl/lx.ifortuna.cz/lxdomain.ifortuna.cz.cer","keyfile":"/home/ansible_master/openshift/ssl/lx.ifortuna.cz/lxdomain.ifortuna.cz.key","names":["czdcp-os1-master.lx.ifortuna.cz"]}]
openshift_master_overwrite_named_certificates=true

# Network configuration
openshift_master_api_port=8443
openshift_master_console_port=8443
openshift_portal_net=10.39.0.0/16
osm_cluster_network_cidr=10.38.0.0/16
osm_host_subnet_length=7
openshift_master_external_ip_network_cidrs=['10.2.171.0/24']
openshift_master_ingress_ip_network_cidr=10.2.171.0/24
os_sdn_network_plugin_name="redhat/openshift-ovs-networkpolicy"
openshift_master_cluster_public_hostname=czdcp-os1-master.lx.ifortuna.cz
openshift_master_cluster_hostname=czdcp-os1-master-int.lx.ifortuna.cz
openshift_master_default_subdomain=p1czos.ifortuna.cz
openshift_registry_selector="infra=generic"
openshift_router_selector="infra=generic"

# Internal registry disk (NFS export -> PV)
openshift_hosted_registry_storage_kind=nfs
openshift_hosted_registry_storage_access_modes=['ReadWriteMany']
openshift_hosted_registry_storage_host=czdcp-os1-nfs01.lx.ifortuna.cz
openshift_hosted_registry_storage_nfs_directory=/opt/export
openshift_hosted_registry_storage_volume_name=p1-registry
openshift_hosted_registry_storage_volume_size=100Gi
openshift_hosted_registry_pullthrough=true


# Custom certificate for internal registry *.p1czos.ifortuna.cz
openshift_hosted_registry_routehost=docker-registry-default.p1czos.ifortuna.cz
openshift_hosted_registry_routecertificates={ "certfile": "/home/ansible_master/openshift/ssl/p1czos.ifortuna.cz/p1czos.ifortuna.cz.crt", "keyfile": "/home/ansible_master/openshift/ssl/p1czos.ifortuna.cz/p1czos.ifortuna.cz.key", "cafile": "/home/ansible_master/openshift/ssl/p1czos.ifortuna.cz/p1czos.ifortuna.cz_IntermediateCA.crt" }
openshift_hosted_registry_routetermination=reencrypt

# Router wildcard cert for app domain 
openshift_hosted_router_certificate={ "certfile": "/home/ansible_master/openshift/ssl/p1czos.ifortuna.cz/p1czos.ifortuna.cz.crt", "keyfile": "/home/ansible_master/openshift/ssl/p1czos.ifortuna.cz/p1czos.ifortuna.cz.key", "cafile": "/home/ansible_master/openshift/ssl/p1czos.ifortuna.cz/p1czos.ifortuna.cz_IntermediateCA.crt" }

#---------------#
# Metrics stack #
#---------------#

# Disk for metrics stack  (NFS export -> PV)
openshift_metrics_storage_kind=nfs
openshift_metrics_storage_access_modes=['ReadWriteOnce']
openshift_metrics_storage_host=czdcp-os1-nfs01.lx.ifortuna.cz
openshift_metrics_storage_nfs_directory=/opt/export
openshift_metrics_storage_volume_name=p1-metrics
openshift_metrics_storage_volume_size=30Gi

# Metrics stack install
openshift_metrics_install_metrics=true
openshift_metrics_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_"
openshift_metrics_cassandra_storage_type=pv
openshift_metrics_cassandra_replicas=1
openshift_metrics_hawkular_replicas=1
openshift_metrics_cassandra_nodeselector={"infra":"generic"}
openshift_metrics_hawkular_nodeselector={"infra":"generic"}
openshift_master_metrics_public_url="https://hawkular-metrics.p1czos.ifortuna.cz/hawkular/metric"

#-----------#
# ELK stack #
#-----------#

# ELK stack install 
openshift_logging_install_logging=true
openshift_logging_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_"
openshift_logging_es_cluster_size=3
openshift_logging_es_number_of_replicas=1
openshift_logging_es_nodeselector={"infra":"elastic"}

# Curator
openshift_logging_curator_nodeselector={"infra":"elastic"}

#------------------#
# Prometheus stack #
#------------------#
openshift_hosted_prometheus_deploy=true
openshift_prometheus_node_selector={"infra":"prometheus"}
openshift_prometheus_namespace=openshift-metrics
openshift_prometheus_hostname="prometheus.p1czos.ifortuna.cz"
openshift_prometheus_alerts_hostname="prometheus-alerts.p1czos.ifortuna.cz"
openshift_prometheus_args=['--storage.tsdb.retention=15d'] 
openshift_prometheus_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_"
openshift_prometheus_node_exporter_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_"
openshift_prometheus_alertmanager_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_"
openshift_prometheus_alertbuffer_image_prefix="czdcm-satellite.lx.ifortuna.cz:5000/ftn-openshift39-openshift3_"

#openshift_prometheus_storage_type: "emptydir"
#openshift_prometheus_pvc_name: prometheus
#openshift_prometheus_pvc_size: "10Gi"
#openshift_prometheus_pvc_access_modes: [ReadWriteOnce]
#openshift_prometheus_pvc_pv_selector: "{}"
#openshift_prometheus_sc_name: "None"

#openshift_prometheus_alertmanager_storage_type: "emptydir"
#openshift_prometheus_alertmanager_pvc_name: prometheus-alertmanager
#openshift_prometheus_alertmanager_pvc_size: "10Gi"
#openshift_prometheus_alertmanager_pvc_access_modes: [ReadWriteOnce]
#openshift_prometheus_alertmanager_pvc_pv_selector: "{}"
#openshift_prometheus_alertmanager_sc_name: "None"

#openshift_prometheus_alertbuffer_storage_type: "emptydir"
#openshift_prometheus_alertbuffer_pvc_name: prometheus-alertbuffer
#openshift_prometheus_alertbuffer_pvc_size: "10Gi"
#openshift_prometheus_alertbuffer_pvc_access_modes: [ReadWriteOnce]
#openshift_prometheus_alertbuffer_pvc_pv_selector: "{}"
#openshift_prometheus_alertbuffer_sc_name: "None"

#---------#
# Grafana #
#---------#
#openshift_hosted_grafana_deploy=true

#--------------------#
# Node configuration #
#--------------------#

# OpenShift Masters
[masters]
czdcp-os1-m01.lx.ifortuna.cz
czdcp-os1-m02.lx.ifortuna.cz
czdcp-os1-m03.lx.ifortuna.cz

# Etcd servers
[etcd]
czdcp-os1-m01.lx.ifortuna.cz
czdcp-os1-m02.lx.ifortuna.cz
czdcp-os1-m03.lx.ifortuna.cz

#### All OpenShift nodes
[nodes]
# Master/Etcd nodes
czdcp-os1-m01.lx.ifortuna.cz openshift_node_group_name='node-config-master'
czdcp-os1-m02.lx.ifortuna.cz openshift_node_group_name='node-config-master'
czdcp-os1-m03.lx.ifortuna.cz openshift_node_group_name='node-config-master'

# Generic Infra nodes
czdcp-os1-i01.lx.ifortuna.cz openshift_node_group_name='node-config-infra'
czdcp-os1-i02.lx.ifortuna.cz openshift_node_group_name='node-config-infra'
czdcp-os1-i03.lx.ifortuna.cz openshift_node_group_name='node-config-infra'

# EFK Infra nodes
czdcp-os1-i-e01.lx.ifortuna.cz openshift_node_group_name='node-config-infra-elastic'
czdcp-os1-i-e02.lx.ifortuna.cz openshift_node_group_name='node-config-infra-elastic'
czdcp-os1-i-e03.lx.ifortuna.cz openshift_node_group_name='node-config-infra-elastic'

# Application EFK nodes
czdcp-os1-a-e01.lx.ifortuna.cz openshift_node_group_name='node-config-compute-elastic'
czdcp-os1-a-e02.lx.ifortuna.cz openshift_node_group_name='node-config-compute-elastic'
czdcp-os1-a-e03.lx.ifortuna.cz openshift_node_group_name='node-config-compute-elastic'
czdcp-os1-a-e04.lx.ifortuna.cz openshift_node_group_name='node-config-compute-elastic'
czdcp-os1-a-e05.lx.ifortuna.cz openshift_node_group_name='node-config-compute-elastic'

# Application mongo nodes
czdcp-os1-a-m01.lx.ifortuna.cz openshift_node_group_name='node-config-compute-mongo'
czdcp-os1-a-m02.lx.ifortuna.cz openshift_node_group_name='node-config-compute-mongo'
czdcp-os1-a-m03.lx.ifortuna.cz openshift_node_group_name='node-config-compute-mongo'
czdcp-os1-a-m04.lx.ifortuna.cz openshift_node_group_name='node-config-compute-mongo'
czdcp-os1-a-m05.lx.ifortuna.cz openshift_node_group_name='node-config-compute-mongo'

# Application rabbit nodes
czdcp-os1-a-r01.lx.ifortuna.cz openshift_node_group_name='node-config-compute-rabbit'
czdcp-os1-a-r02.lx.ifortuna.cz openshift_node_group_name='node-config-compute-rabbit'
czdcp-os1-a-r03.lx.ifortuna.cz openshift_node_group_name='node-config-compute-rabbit'
czdcp-os1-a-r04.lx.ifortuna.cz openshift_node_group_name='node-config-compute-rabbit'
czdcp-os1-a-r05.lx.ifortuna.cz openshift_node_group_name='node-config-compute-rabbit'

# Prometheus Infra nodes
czdcp-os1-i-p01.lx.ifortuna.cz openshift_node_group_name='node-config-infra-prometheus'

# Generic Application nodes
czdcp-os1-a01.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a02.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a03.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a04.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a05.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a06.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a07.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a08.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a09.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a10.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a11.lx.ifortuna.cz openshift_node_group_name='node-config-compute'
czdcp-os1-a12.lx.ifortuna.cz openshift_node_group_name='node-config-compute'


